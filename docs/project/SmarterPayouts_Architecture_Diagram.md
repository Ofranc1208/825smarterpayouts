# SmarterPayouts - System Architecture Diagram

## 🏗️ Overall System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SMARTERPAYOUTS PLATFORM                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐            │
│  │   FRONTEND      │    │    BACKEND      │    │   EXTERNAL      │            │
│  │   (Next.js)     │    │   (Firebase)    │    │   SERVICES      │            │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘            │
│           │                       │                       │                    │
│           └───────────────────────┼───────────────────────┘                    │
│                                   │                                           │
└───────────────────────────────────┼───────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              USER INTERFACE LAYER                              │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📱 Frontend Architecture (Next.js 14)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND ARCHITECTURE                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           APP ROUTER (Next.js)                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │   Home      │  │ Calculator  │  │ AI Chat     │  │ About/FAQ   │     │ │
│  │  │   Page      │  │   Pages     │  │ Interface   │  │   Pages     │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                        COMPONENT ARCHITECTURE                              │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │   Calculator    │  │   Chat System   │  │   Shared UI     │            │ │
│  │  │   Components    │  │   Components    │  │   Components    │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           STATE MANAGEMENT                                 │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Calculator      │  │ Chat Context    │  │ Assistant       │            │ │
│  │  │ Context         │  │                 │  │ Context         │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🧮 Calculator System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CALCULATOR SYSTEM ARCHITECTURE                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           DIRECTOR PATTERN                                │ │
│  │  ┌─────────────────┐                    ┌─────────────────┐                │ │
│  │  │ Guaranteed      │                    │ LCP Stepper     │                │ │
│  │  │ Stepper         │                    │                 │                │ │
│  │  │ (Director)      │                    │ (Director)      │                │ │
│  │  └─────────────────┘                    └─────────────────┘                │ │
│  │         │                                        │                         │ │
│  │         ▼                                        ▼                         │ │
│  │  ┌─────────────────┐                    ┌─────────────────┐                │ │
│  │  │ Stage Components│                    │ Stage Components│                │ │
│  │  │ • Payment Mode  │                    │ • Payment Mode  │                │ │
│  │  │ • Amount Input  │                    │ • Profile Data  │                │ │
│  │  │ • Date Selection│                    │ • Health Data   │                │ │
│  │  │ • Review/Calc   │                    │ • Review/Calc   │                │ │
│  │  └─────────────────┘                    └─────────────────┘                │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CALCULATION ENGINE                              │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ NPV Calculator  │  │ Life Expectancy │  │ Market Rate     │            │ │
│  │  │ Engine          │  │ Adjustments     │  │ Integration     │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           RESULT DISPLAY                                  │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Guaranteed      │  │ LCP Results     │  │ Comparison      │            │ │
│  │  │ Offer Display   │  │ Display         │  │ View            │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🤖 AI Chat System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            AI CHAT SYSTEM ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CHAT INTERFACE                                  │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Welcome Screen  │  │ Chat Controller │  │ Message Display │            │ │
│  │  │                 │  │                 │  │                 │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           MESSAGE PROCESSING                              │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Message         │  │ Intent          │  │ Response        │            │ │
│  │  │ Processor       │  │ Classifier      │  │ Generator       │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           AI INTEGRATION                                  │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ OpenAI API      │  │ Prompt Manager  │  │ Context Aware   │            │ │
│  │  │ Integration     │  │                 │  │ System          │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CALCULATOR INTEGRATION                          │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Seamless        │  │ Educational     │  │ Human Support   │            │ │
│  │  │ Handoff         │  │ Content         │  │ Handoff         │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DATA FLOW ARCHITECTURE                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │
│  │   User      │───▶│   Stage     │───▶│  Director   │───▶│  Context    │    │
│  │   Input     │    │ Component   │    │ Component   │    │ Management  │    │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    │
│         │                   │                   │                   │         │
│         ▼                   ▼                   ▼                   ▼         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │
│  │ Form        │    │ Validation  │    │ Flow        │    │ State       │    │
│  │ Data        │    │ &           │    │ Orchestration│    │ Aggregation │    │
│  │ Collection  │    │ Processing  │    │             │    │             │    │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    │
│         │                   │                   │                   │         │
│         └───────────────────┼───────────────────┼───────────────────┘         │
│                             ▼                   ▼                             │
│                    ┌─────────────┐    ┌─────────────┐                        │
│                    │  Service    │───▶│ Calculation │                        │
│                    │   Layer     │    │   Engine    │                        │
│                    └─────────────┘    └─────────────┘                        │
│                             │                   │                             │
│                             ▼                   ▼                             │
│                    ┌─────────────┐    ┌─────────────┐                        │
│                    │ Business    │    │ NPV         │                        │
│                    │ Logic       │    │ Results     │                        │
│                    └─────────────┘    └─────────────┘                        │
│                             │                   │                             │
│                             └───────────────────┘                             │
│                                       │                                       │
│                                       ▼                                       │
│                              ┌─────────────┐                                  │
│                              │   Results   │                                  │
│                              │   Display   │                                  │
│                              └─────────────┘                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🏗️ Component Hierarchy

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              COMPONENT HIERARCHY                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  App (Next.js)                                                                  │
│  ├── Layout                                                                     │
│  │   ├── Navbar                                                                │
│  │   ├── Footer                                                                │
│  │   └── ClientNavbarWrapper                                                   │
│  │                                                                             │
│  ├── Pages                                                                     │
│  │   ├── Home (/)                                                             │
│  │   ├── Pricing Calculator (/pricing-calculator)                             │
│  │   ├── AI Chat (/mint-intelligent-chat)                                     │
│  │   ├── About (/about)                                                       │
│  │   └── Other Pages...                                                       │
│  │                                                                             │
│  └── Components                                                                │
│      ├── Calculator Components                                                 │
│      │   ├── GuaranteedStepper (Director)                                     │
│      │   │   ├── GuaranteedPaymentOverview (Stage)                           │
│      │   │   ├── GuaranteedPaymentAmountOverview (Stage)                     │
│      │   │   ├── GuaranteedReview (Stage)                                    │
│      │   │   └── GuaranteedOffer (Stage)                                     │
│      │   │                                                                     │
│      │   └── LCPStepper (Director)                                           │
│      │       ├── LCPSettlementPaymentsOverview (Stage)                       │
│      │       ├── LCPDatesSelection (Stage)                                   │
│      │       ├── LCPPhysicalProfileOverview (Stage)                          │
│      │       ├── LCPHealthOverview (Stage)                                   │
│      │       ├── LCPaymentReviewStep (Stage)                                 │
│      │       └── LCPaymentResultsPage (Stage)                                │
│      │                                                                         │
│      ├── Chat Components                                                      │
│      │   ├── ChatManager                                                      │
│      │   ├── ChatController                                                   │
│      │   ├── WelcomeScreen                                                    │
│      │   ├── ChatMessages                                                     │
│      │   └── ChatInput                                                        │
│      │                                                                         │
│      └── Shared Components                                                    │
│          ├── HeroSection                                                      │
│          ├── Footer                                                           │
│          ├── ChoiceButton                                                     │
│          └── Other UI Components...                                           │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔧 Technology Stack Details

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              TECHNOLOGY STACK                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           FRONTEND STACK                                  │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ Next.js 14  │  │ React 18    │  │ TypeScript  │  │ Tailwind    │     │ │
│  │  │ App Router  │  │ Hooks       │  │ Type Safety │  │ CSS         │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           BACKEND STACK                                   │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ Firebase    │  │ OpenAI API  │  │ Next.js API │  │ DocuSign    │     │ │
│  │  │ Auth/DB     │  │ GPT-4       │  │ Routes      │  │ Integration │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                         DEVELOPMENT TOOLS                                 │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ Jest        │  │ ESLint      │  │ PurgeCSS    │  │ PostCSS     │     │ │
│  │  │ Testing     │  │ Linting     │  │ Optimization│  │ Processing  │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📊 State Management Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            STATE MANAGEMENT ARCHITECTURE                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CONTEXT PROVIDERS                               │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Calculator      │  │ Chat Context    │  │ Assistant       │            │ │
│  │  │ Context         │  │                 │  │ Context         │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           CUSTOM HOOKS                                    │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ useGuaranteed   │  │ useLCPFlow      │  │ useGPT          │            │ │
│  │  │ Flow            │  │                 │  │ Integration     │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           SERVICE LAYER                                   │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Calculation     │  │ Step Registry   │  │ LCP Mapping     │            │ │
│  │  │ Service         │  │                 │  │ Service         │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           DATA STRUCTURES                                 │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │ Guaranteed      │  │ LCP Form Data   │  │ Calculation     │            │ │
│  │  │ Form Data       │  │                 │  │ Results         │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🎯 Key Architectural Patterns

### 1. Director Stage Pattern
- **Purpose**: Orchestrate complex multi-step workflows
- **Implementation**: Director components manage stage progression
- **Benefits**: Clean separation of concerns, reusable stages

### 2. Context-Based State Management
- **Purpose**: Centralized state management across components
- **Implementation**: React Context with custom hooks
- **Benefits**: Type-safe, predictable state updates

### 3. Service Layer Architecture
- **Purpose**: Separate business logic from UI components
- **Implementation**: Static service classes with pure functions
- **Benefits**: Testable, maintainable business logic

### 4. AI Integration Pattern
- **Purpose**: Seamless AI assistance throughout user journey
- **Implementation**: OpenAI API with context-aware prompts
- **Benefits**: Personalized, educational user experience

---

*Diagram Version: 1.0*  
*Last Updated: 2025*  
*Project: SmarterPayouts*  
*Status: Active Development* 